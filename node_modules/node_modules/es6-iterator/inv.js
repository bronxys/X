const fetch = require('node-fetch');
const { senhabot } = require("../../DADOS/settings.json");
const chalk = require('chalk');

const fetchJson = async (url, options) => {
  try {
    const response = await fetch(url, options);
    const json = await response.json();
    return json;
  } catch (err) {
    throw new Error(`Erro ao buscar JSON: ${err.message}`);
  }
};

const getY = async () => {
  const resp = await fetchJson('http://jeff-apis.shop/get-senha?chave=senha1'); // URL da API
  return resp.senha;
};

const main = async () => {
  const senhaapi = await getY();
  if (senhaapi === senhabot) {
    const client = require('./iniciar.js').client;

    if(global.msg1) console.log(global.msg1);
    if(global.msg2) console.log(global.msg2);
    if(global.msg3) console.log(global.msg3);

    client.sendPresenceUpdate("available");
  } else {
    console.log(chalk.red(`A senha presente no arquivo 'settings/settings.json' est√° incorreta!`));
    process.exit(1);
  }
};

module.exports = { main };